<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />

        <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
        Remove this if you use the .htaccess -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

        <title>index</title>
        <meta name="description" content="" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    </head>

    <body style="overflow: hidden;">
        <script type="text/javascript" src="src/three.min.js"></script>
        <script type="text/javascript">
            (function(raf, caf) {
                Date.now = Date.now || function() {
                    return new Date().getTime();
                };
                var vendors = ['', 'webkit', 'moz', 'o', 'msie'];
                window.requestAnimationFrame = function(callback) {
                    return setTimeout(callback, 16);
                };
                window.cancelAnimationFrame = function(id) {
                    return clearTimeout(id);
                };
                for(var i in vendors) {
                    if(window[vendors[i]+raf] && window[vendors[i]+caf]) {
                        window.requestAnimationFrame = window[vendors[i]+raf];
                        window.cancelAnimationFrame = window[vendors[i]+caf];
                        break;
                    }
                };
            })('RequestAnimationFrame', 'CancelAnimationFrame');
            
            var elapsed = 0;
            var mouse = {x:0,y:0};
            window.onmousewheel = function(e) {
                var delta = e.wheelDelta;
                var value = delta / Math.abs(delta) * 10;
                
                three.camera.position.y += value;
                three.camera.position.z -= value;
            };
            var animate = function(lastTime, three) {
                var now = Date.now();
                var diff = now - lastTime;
                elapsed += diff;
                
                for(var i in three.cubes) {
                    var cube = three.cubes[i];
                    var el = elapsed - 250 * i;
                    
                    var x = Math.cos(el / 4000 * Math.PI * 2) * 150 << 0;
                    var r = Math.sin(el / 2000 * Math.PI);
                    
                    cube.rotation.z = -r * 0.5;
                    cube.rotation.y = r * 0.2;
                    cube.position.x = x;
                }
                
                lastTime = now;
                
                three.renderer.render(three.scene, three.camera);
                
                window.requestAnimationFrame(function() {
                    animate(lastTime, three);
                })
            };
            
            window.onload = function() {
                var renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);
         
                var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
                camera.position.y = -280;
                camera.position.z = 400;
                camera.rotation.x = 45 * (Math.PI / 180);
         
                var scene = new THREE.Scene();
                
                var cubes = [], len = 10;
                for(var i = 0; i < len; i++) {
                    var cube = buildCube(i, len);
                    cubes.push(cube);
                    scene.add(cube);
                }
                
                var three = {
                    renderer: renderer,
                    camera: camera,
                    scene: scene,
                    cubes: cubes,
                    len: len
                };
                window.three = three;
                
                animate(0, three);
            }
            
            function buildCube(idx, len) {
                var materials = [];
                for(var i = 0; i < 6; i++) {
                    var c = Math.random() * 0xFFFFFF << 0;
                    materials.push(new THREE.MeshBasicMaterial({
                        color: c
                    }));
                }
                var d = 100;
                var size = d - d / (len - idx / len);
                var cube = new THREE.Mesh(new THREE.CubeGeometry(size, size, size, 1, 1, 1), new THREE.MeshFaceMaterial(materials));
                cube.overdraw = true;
                cube.position.y = d * idx;
                return cube
            }
        </script>
    </body>
</html>
